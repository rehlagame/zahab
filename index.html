<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="dark">
    <meta name="theme-color" content="#0f1115">
    <title>Ø²Ù‡Ø§Ø¨ | Zahab</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-main: #0f1115;
            --bg-card: #1c1f26;
            --primary: #d68c45;
            --primary-glow: rgba(214, 140, 69, 0.4);
            --whatsapp: #25D366;
            --text-main: #FFFFFF;
            --text-sec: #9CA3AF;
            --success: #10B981;
            --danger: #EF4444;
            --radius-lg: 16px;
            --radius-md: 10px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            padding-bottom: 110px;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header --- */
        header {
            background: rgba(15, 17, 21, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .header-content { max-width: 600px; margin: 0 auto; }

        .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .logo-icon {
            width: 38px;
            height: 38px;
            background: rgba(214, 140, 69, 0.15);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            border: 1px solid rgba(214, 140, 69, 0.3);
        }
        .logo-icon svg { width: 22px; height: 22px; fill: currentColor; }

        .brand h1 {
            font-weight: 800;
            font-size: 1.4rem;
            color: var(--primary);
            line-height: 1;
        }

        .app-desc {
            background: linear-gradient(90deg, rgba(214, 140, 69, 0.08) 0%, rgba(255,255,255,0.02) 100%);
            border: 1px solid rgba(214, 140, 69, 0.15);
            border-right: 3px solid var(--primary);
            border-radius: var(--radius-md);
            padding: 10px;
            font-size: 0.8rem;
            color: #ddd;
            line-height: 1.5;
        }

        /* --- Trip Info (ØªÙ… Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ù‡Ù†Ø§) --- */
        .container { max-width: 800px; margin: 0 auto; padding: 0 15px; flex: 1; }

        .info-card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 15px 12px;
            margin-top: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            display: grid;
            /* Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø­Ø±ÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¯Ø§Ø®Ù„: minmax(0, 1fr) */
            grid-template-columns: repeat(2, minmax(0, 1fr));
            gap: 10px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 0; /* Ø¶Ø±ÙˆØ±ÙŠ Ù„Ø¹Ø¯Ù… Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù† Ø§Ù„Ø¥Ø·Ø§Ø± */
        }

        /* Ù‡Ø°Ø§ ÙŠØ¬Ø¹Ù„ Ø®Ø§Ù†Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªØ£Ø®Ø° Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„ */
        .input-group.full { grid-column: span 2; }

        .input-group label {
            font-size: 0.75rem;
            color: var(--primary);
            font-weight: 700;
            white-space: nowrap; /* ÙŠÙ…Ù†Ø¹ Ù†Ø²ÙˆÙ„ Ø§Ù„Ù†Øµ Ù„Ø³Ø·Ø± Ø«Ø§Ù†ÙŠ */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .styled-input {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 0 10px; /* Ø§Ø³ØªØ®Ø¯Ø§Ù… padding Ø£ÙÙ‚ÙŠ ÙÙ‚Ø· */
            border-radius: 8px;
            font-family: inherit;
            font-size: 0.85rem;
            outline: none;
            width: 100%;
            height: 40px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø§Ù†Ø§Øª */
            line-height: 40px;
        }
        .styled-input:focus { border-color: var(--primary); }

        /* ØªØ­Ø³ÙŠÙ† Ø®Ø§Øµ Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª ÙÙŠ Ø§Ù„Ø¢ÙŠÙÙˆÙ† */
        input[type="date"], input[type="time"] {
            display: block;
            -webkit-appearance: none;
            appearance: none;
            min-height: 40px;
        }

        /* --- Filters --- */
        .filters {
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 12px 0;
        }
        select {
            background: var(--bg-card); color: white; border: 1px solid rgba(255,255,255,0.1);
            padding: 0 10px; border-radius: 8px; width: 100%; font-family: inherit; font-size: 0.85rem; height: 40px;
        }

        /* --- Progress --- */
        .progress-box { margin-bottom: 15px; }
        .progress-track { background: #2A2E37; height: 6px; border-radius: 3px; overflow: hidden; }
        .progress-fill {
            background: var(--primary); height: 100%; width: 0%; transition: width 0.3s;
            box-shadow: 0 0 10px var(--primary-glow);
        }
        .stats { display: flex; justify-content: space-between; margin-top: 4px; font-size: 0.75rem; color: var(--text-sec); }

        /* --- List Items --- */
        .category-card {
            background: var(--bg-card); border-radius: var(--radius-lg); padding: 12px;
            margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.03);
        }
        .cat-title { color: var(--primary); font-weight: 700; margin-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; font-size: 0.95rem; }

        .item {
            display: flex; align-items: center; padding: 10px 8px; margin-bottom: 6px;
            background: rgba(255,255,255,0.02); border-radius: 8px; cursor: pointer;
            transition: 0.2s;
        }
        .item.checked { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); }
        .item.checked span { text-decoration: line-through; color: #6B7280; }

        .checkbox {
            width: 20px; height: 20px; border: 2px solid #555; border-radius: 5px; margin-left: 10px;
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .item.checked .checkbox { background: var(--success); border-color: var(--success); }
        .item.checked .checkbox::after { content: 'âœ“'; color: white; font-size: 12px; font-weight: bold; }
        .item span { font-size: 0.9rem; }

        .del-btn { color: var(--danger); padding: 5px 10px; font-size: 1.2rem; margin-right: auto; }

        /* --- Footer --- */
        .app-footer {
            text-align: center;
            padding: 10px 0 20px 0;
            margin-top: auto;
            font-size: 0.75rem;
            color: var(--text-sec);
            opacity: 0.8;
        }
        .app-footer a { color: var(--text-main); text-decoration: none; font-weight: 600; }

        /* --- Bottom Bar --- */
        .bottom-bar {
            position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%);
            width: 92%; max-width: 450px;
            background: rgba(20, 22, 28, 0.96); backdrop-filter: blur(15px);
            padding: 6px 10px;
            border-radius: 100px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.6);
            display: flex; gap: 6px; z-index: 200; align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .add-input {
            flex: 1; background: transparent; border: none; color: white;
            padding: 0 10px; font-family: inherit; font-size: 0.9rem;
        }
        .add-input:focus { outline: none; }

        .btn {
            width: 36px; height: 36px;
            border-radius: 50%; border: none; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            color: white; flex-shrink: 0; font-size: 1rem;
            transition: transform 0.1s;
        }
        .btn svg { width: 18px; height: 18px; }
        .btn:active { transform: scale(0.9); }

        .btn-add { background: var(--primary); }
        .btn-wa { background: var(--whatsapp); }
        .btn-copy { background: #333; }
        .btn-reset { background: rgba(239, 68, 68, 0.15); color: var(--danger); width: 34px; height: 34px; }
        .btn-reset svg { width: 16px; height: 16px; }

        .divider { width: 1px; height: 18px; background: rgba(255,255,255,0.15); margin: 0 2px; }

        .toast {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: var(--success); color: white; padding: 12px 20px; border-radius: 20px;
            display: none; z-index: 300; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<header>
    <div class="header-content">
        <div class="brand">
            <div class="logo-icon">
                <svg viewBox="0 0 24 24"><path d="M19,10c-1.3,0-2.4,0.8-2.8,2H16l-3.3-6.6c-0.4-0.8-1.5-0.8-1.9,0L2.3,20.6C2.1,21,2,21.5,2.4,21.8 C2.6,21.9,2.8,22,3,22h14.2c-0.1-0.6-0.2-1.3-0.2-2c0-3.3,2.7-6,6-6c0.3,0,0.7,0,1,0.1V12C24,10.9,23.1,10,22,10H19z M12,16 c0,1.1-0.9,2-2,2s-2-0.9-2-2h-2c0,2.2,1.8,4,4,4s4-1.8,4-4H12z"/></svg>
            </div>
            <h1>Ø²Ù‡Ø§Ø¨ | Zahab</h1>
        </div>
        <div class="app-desc">
            1. Ø­Ø¯Ø¯ "Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª".<br>
            2. Ø§Ø®ØªØ± "Ù†ÙˆØ¹ Ø§Ù„Ø±Ø­Ù„Ø©" Ù…Ù† Ø§Ù„ÙÙ„ØªØ±.<br>
            3. Ø­Ø¯Ø¯ Ø²Ù‡Ø§Ø¨Ùƒ âœ… ÙˆØ£Ø¶Ù Ø§Ù„Ù†ÙˆØ§Ù‚Øµ.<br>
            4. Ø´Ø§Ø±Ùƒ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ ÙÙˆØ±Ø§Ù‹! ğŸš€
        </div>
    </div>
</header>

<div class="container">
    <div class="info-card">
        <div class="input-group">
            <label>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
            <input type="date" id="tripDate" class="styled-input" onchange="app.save()">
        </div>
        <div class="input-group">
            <label>ğŸ• ÙˆÙ‚Øª Ø§Ù„ØªØ­Ø±Ùƒ</label>
            <input type="time" id="tripTime" class="styled-input" onchange="app.save()">
        </div>
        <div class="input-group full">
            <label>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø±Ø§Ø¨Ø·)</label>
            <input type="text" id="tripLoc" class="styled-input" placeholder="Ø±Ø§Ø¨Ø· Ù‚ÙˆÙ‚Ù„ Ù…Ø§Ø¨..." oninput="app.save()">
        </div>
    </div>

    <div class="filters">
        <select id="tripType" onchange="app.render()">
            <option value="all">Ø§Ù„Ø±Ø­Ù„Ø©: Ø§Ù„Ø¬Ù…ÙŠØ¹ (Ø´Ø§Ù…Ù„)</option>
            <option value="coffee">â˜• Ù‚Ù‡ÙˆØ© Ø®ÙØ§ÙÙŠ</option>
            <option value="lunch">ğŸ¥˜ ØºØ¯Ø§Ø¡/Ø¹Ø´Ø§Ø¡</option>
            <option value="sleep">â›º Ù…Ø¨ÙŠØª ÙƒØ§Ù…Ù„</option>
        </select>
        <select id="weatherType" onchange="app.render()">
            <option value="winter">â„ï¸ Ø´ØªØ§Ø¡ (Ø¨Ø±Ø¯)</option>
            <option value="fair">Ø§Ù„Ø¬Ùˆ: Ù…Ø¹ØªØ¯Ù„</option>
        </select>
    </div>

    <div class="progress-box">
        <div class="progress-track"><div class="progress-fill" id="progressBar"></div></div>
        <div class="stats"><span id="progressText">Ø§Ù„Ø­Ø§Ù„Ø©</span><span id="itemsCount">0/0</span></div>
    </div>

    <div id="gridContainer"></div>
</div>

<!-- Ø§Ù„Ø­Ù‚ÙˆÙ‚ (Footer) -->
<footer class="app-footer">
    Developed by <a href="https://www.olosolutions.cc/" target="_blank">Olo Solution</a>
</footer>

<!-- Bottom Bar -->
<div class="bottom-bar">
    <input type="text" id="customInput" class="add-input" placeholder="Ø£Ø¶Ù ØºØ±Ø¶...">
    <button class="btn btn-add" onclick="app.addCustom()">+</button>
    <div class="divider"></div>
    <button class="btn btn-wa" onclick="app.shareWhatsApp()">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </button>
    <button class="btn btn-copy" onclick="app.copyList()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
    </button>
    <button class="btn btn-reset" onclick="app.reset()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
    </button>
</div>

<div id="toast" class="toast"></div>

<script>
    const app = {
        // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db: [
            { id: 101, name: "Ø¯Ù„Ø© Ø§Ù„Ù‚Ù‡ÙˆØ©", cat: "coffee", tags: ["all"] },
            { id: 102, name: "Ø¥Ø¨Ø±ÙŠÙ‚ Ø´Ø§ÙŠ", cat: "coffee", tags: ["all"] },
            { id: 103, name: "ÙÙ†Ø§Ø¬ÙŠÙ„ ÙˆØ¨ÙŠØ§Ù„Ø§Øª", cat: "coffee", tags: ["all"] },
            { id: 104, name: "Ø¨Ù† ÙˆÙ‡ÙŠÙ„ ÙˆØ²Ø¹ÙØ±Ø§Ù†", cat: "coffee", tags: ["all"] },
            { id: 105, name: "Ø³ÙƒØ± ÙˆØ´Ø§ÙŠ", cat: "coffee", tags: ["all"] },
            { id: 106, name: "ØªÙ…Ø± ÙˆØ·Ø­ÙŠÙ†Ø©", cat: "coffee", tags: ["all"] },
            { id: 107, name: "Ø¯Ø¨Ø© Ù…Ø§Ø¡ Ø­Ù„Ùˆ", cat: "coffee", tags: ["all"] },
            { id: 108, name: "Ø¯Ø§ÙÙˆØ± ÙˆØ°Ø±Ø§ÙŠØ©", cat: "coffee", tags: ["all"] },
            { id: 201, name: "Ù‚Ø¯Ø± ÙƒØ§ØªÙ…", cat: "cooking", tags: ["lunch","sleep"] },
            { id: 202, name: "ØµØ­Ù† ÙƒØ¨ÙŠØ± (ØªØ¨Ø³ÙŠ)", cat: "cooking", tags: ["lunch","sleep"] },
            { id: 203, name: "Ø³ÙƒØ§ÙƒÙŠÙ† ÙˆÙ…Ù„Ø§Ø¹Ù‚", cat: "cooking", tags: ["lunch","sleep"] },
            { id: 204, name: "Ù„ÙˆØ­ ØªÙ‚Ø·ÙŠØ¹", cat: "cooking", tags: ["lunch","sleep"] },
            { id: 205, name: "Ø¨Ù‡Ø§Ø±Ø§Øª ÙˆÙ…Ù„Ø­ ÙˆØ²ÙŠØª", cat: "cooking", tags: ["lunch","sleep"] },
            { id: 206, name: "Ù„Ø­Ù… / Ø¯Ø¬Ø§Ø¬", cat: "cooking", tags: ["lunch","sleep"] },
            { id: 207, name: "Ø£Ø±Ø² ÙˆØ¨ØµÙ„ ÙˆØ·Ù…Ø§Ø·Ù…", cat: "cooking", tags: ["lunch","sleep"] },
            { id: 208, name: "Ø³ÙØ±Ø© ÙˆÙ…Ù†Ø§Ø¯ÙŠÙ„", cat: "cooking", tags: ["lunch","sleep"] },
            { id: 301, name: "Ø´Ø¨Ùƒ Ø´ÙˆÙŠ", cat: "grill", tags: ["lunch","sleep"] },
            { id: 302, name: "ÙØ­Ù… ÙˆÙ…ÙƒØ¹Ø¨Ø§Øª", cat: "grill", tags: ["lunch","sleep"] },
            { id: 303, name: "Ù…Ù„Ù‚Ø· ÙˆÙ…Ù†Ù‚Ø§Ø´", cat: "grill", tags: ["lunch","sleep"] },
            { id: 401, name: "ÙØ±Ø´Ø§Øª Ø£Ø±Ø¶ÙŠØ©", cat: "sleep", tags: ["all"] },
            { id: 402, name: "ÙƒØ±Ø§Ø³ÙŠ ÙˆÙ…Ø±Ø§ÙƒÙŠ", cat: "sleep", tags: ["all"] },
            { id: 403, name: "Ø®ÙŠÙ…Ø© ÙˆØ±ÙˆØ§Ù‚", cat: "sleep", tags: ["sleep"] },
            { id: 404, name: "ÙØ±Ø§Ø´ Ù†ÙˆÙ…", cat: "sleep", tags: ["sleep"] },
            { id: 405, name: "ÙƒØ´Ø§ÙØ§Øª ÙˆÙ„Ù…Ø¨Ø§Øª", cat: "sleep", tags: ["sleep", "lunch"] },
            { id: 501, name: "Ù…Ø§Ø¡ ØºØ³ÙŠÙ„", cat: "hygiene", tags: ["all"] },
            { id: 502, name: "ØµØ§Ø¨ÙˆÙ† ÙˆÙÙŠØ±ÙŠ", cat: "hygiene", tags: ["all"] },
            { id: 503, name: "Ø£ÙƒÙŠØ§Ø³ Ù†ÙØ§ÙŠØ§Øª", cat: "hygiene", tags: ["all"] },
            { id: 601, name: "Ù…Ø§Ø·ÙˆØ± Ù‡ÙˆØ§Ø¡", cat: "car", tags: ["all"] },
            { id: 602, name: "Ø§Ø´ØªØ±Ø§Ùƒ ÙˆÙˆØ§ÙŠØ±", cat: "car", tags: ["all"] },
            { id: 603, name: "Ø¹Ø¯Ø© ÙˆØ´Ù†Ø·Ø© Ø§Ø³Ø¹Ø§ÙØ§Øª", cat: "car", tags: ["all"] },
            { id: 701, name: "ÙØ±ÙˆØ© ÙˆØ¬Ø§ÙƒÙŠØª", cat: "winter", tags: ["winter_only"] },
            { id: 702, name: "Ø­Ø·Ø¨ Ø²ÙŠØ§Ø¯Ø©", cat: "winter", tags: ["winter_only"] },
            { id: 703, name: "Ø²Ù†Ø¬Ø¨ÙŠÙ„ ÙˆØ­Ù„ÙŠØ¨", cat: "winter", tags: ["winter_only"] }
        ],

        categories: {
            "coffee": "â˜• Ø§Ù„Ù‚Ù‡ÙˆØ© ÙˆØ§Ù„Ø´Ø§ÙŠ",
            "cooking": "ğŸ¥˜ Ø§Ù„Ø·Ø¨Ø® ÙˆØ§Ù„Ù…Ù‚Ø§Ø¶ÙŠ",
            "grill": "ğŸ”¥ Ø§Ù„Ø´ÙˆÙŠ ÙˆØ§Ù„ÙØ­Ù…",
            "sleep": "â›º Ø§Ù„Ù…Ø¨ÙŠØª ÙˆØ§Ù„Ø¬Ù„Ø³Ø©",
            "hygiene": "âœ¨ Ø§Ù„Ù†Ø¸Ø§ÙØ©",
            "car": "ğŸš™ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙˆØ§Ù„Ø·ÙˆØ§Ø±Ø¦",
            "winter": "â„ï¸ Ø§Ù„Ø´ØªØ§Ø¡",
            "custom": "ğŸ“ Ø¥Ø¶Ø§ÙØ§ØªÙƒ"
        },

        state: { checked: [], custom: [] },

        init: function() {
            const saved = localStorage.getItem('zihab_v3');
            if (saved) this.state = JSON.parse(saved);

            if(localStorage.getItem('z3_date')) document.getElementById('tripDate').value = localStorage.getItem('z3_date');
            if(localStorage.getItem('z3_time')) document.getElementById('tripTime').value = localStorage.getItem('z3_time');
            if(localStorage.getItem('z3_loc')) document.getElementById('tripLoc').value = localStorage.getItem('z3_loc');

            if(localStorage.getItem('z3_type')) document.getElementById('tripType').value = localStorage.getItem('z3_type');
            if(localStorage.getItem('z3_weather')) document.getElementById('weatherType').value = localStorage.getItem('z3_weather');

            document.getElementById('customInput').addEventListener('keypress', (e) => {
                if(e.key === 'Enter') app.addCustom();
            });

            this.render();
        },

        save: function() {
            localStorage.setItem('zihab_v3', JSON.stringify(this.state));
            localStorage.setItem('z3_date', document.getElementById('tripDate').value);
            localStorage.setItem('z3_time', document.getElementById('tripTime').value);
            localStorage.setItem('z3_loc', document.getElementById('tripLoc').value);
            localStorage.setItem('z3_type', document.getElementById('tripType').value);
            localStorage.setItem('z3_weather', document.getElementById('weatherType').value);
            this.updateProgress();
        },

        toggle: function(id) {
            const strId = String(id);
            const index = this.state.checked.indexOf(strId);
            if (index === -1) this.state.checked.push(strId);
            else this.state.checked.splice(index, 1);
            this.render();
            this.save();
        },

        addCustom: function() {
            const input = document.getElementById('customInput');
            const val = input.value.trim();
            if (!val) return;
            const newItem = { id: 'c_' + Date.now(), name: val, cat: 'custom', tags: ['all'] };
            this.state.custom.push(newItem);
            input.value = '';
            this.render();
            this.save();
            setTimeout(() => window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }), 100);
        },

        removeCustom: function(e, id) {
            e.stopPropagation();
            if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØºØ±Ø¶ØŸ')) return;
            const strId = String(id);
            this.state.custom = this.state.custom.filter(i => String(i.id) !== strId);
            this.state.checked = this.state.checked.filter(i => i !== strId);
            this.render();
            this.save();
        },

        reset: function() {
            if(confirm('ØªØµÙÙŠØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ØŸ')) {
                this.state.checked = [];
                document.getElementById('tripDate').value = '';
                document.getElementById('tripTime').value = '';
                document.getElementById('tripLoc').value = '';
                this.render();
                this.save();
            }
        },

        getVisibleItems: function() {
            const trip = document.getElementById('tripType').value;
            const weather = document.getElementById('weatherType').value;
            const allItems = [...this.db, ...this.state.custom];

            return allItems.filter(item => {
                if (weather === 'winter' && item.tags.includes('winter_only')) return true;
                if (weather !== 'winter' && item.tags.includes('winter_only')) return false;
                if (item.cat === 'custom') return true;
                if (trip === 'all' && !item.tags.includes('winter_only')) return true;
                return item.tags.includes(trip) || item.tags.includes('all');
            });
        },

        render: function() {
            const container = document.getElementById('gridContainer');
            container.innerHTML = '';
            const items = this.getVisibleItems();
            const groups = {};
            items.forEach(item => { if (!groups[item.cat]) groups[item.cat] = []; groups[item.cat].push(item); });
            const order = ['coffee', 'cooking', 'grill', 'sleep', 'hygiene', 'car', 'winter', 'custom'];

            order.forEach(cat => {
                if (groups[cat] && groups[cat].length > 0) {
                    const card = document.createElement('div');
                    card.className = 'category-card';
                    let html = `<div class="cat-title">${this.categories[cat]}</div><div>`;
                    groups[cat].forEach(item => {
                        const isChecked = this.state.checked.includes(String(item.id));
                        html += `
                        <div class="item ${isChecked ? 'checked' : ''}" onclick="app.toggle('${item.id}')">
                            <div class="checkbox"></div>
                            <span style="flex:1; margin-right:12px; font-weight:500;">${item.name}</span>
                            ${String(item.id).startsWith('c_') ? `<span class="del-btn" onclick="app.removeCustom(event, '${item.id}')">Ã—</span>` : ''}
                        </div>`;
                    });
                    html += `</div>`;
                    card.innerHTML = html;
                    container.appendChild(card);
                }
            });
            this.updateProgress();
        },

        updateProgress: function() {
            const items = this.getVisibleItems();
            const total = items.length;
            const checkedCount = items.filter(i => this.state.checked.includes(String(i.id))).length;
            const percent = total === 0 ? 0 : Math.round((checkedCount / total) * 100);
            const bar = document.getElementById('progressBar');
            bar.style.width = percent + '%';
            bar.style.backgroundColor = percent === 100 ? '#10B981' : '#d68c45';
            document.getElementById('itemsCount').textContent = `${checkedCount}/${total}`;
            document.getElementById('progressText').textContent = percent === 100 ? 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚!' : 'Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¬Ù‡ÙŠØ²';
        },

        generateText: function() {
            const date = document.getElementById('tripDate').value;
            const time = document.getElementById('tripTime').value;
            const loc = document.getElementById('tripLoc').value;
            let text = `*â›º Ø²Ù‡Ø§Ø¨ (Zahab) - Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø­Ù„Ø©*\n`;
            if(date || time || loc) {
                text += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
                if(date) text += `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${date}\n`;
                if(time) text += `ğŸ• Ø§Ù„ØªØ­Ø±Ùƒ: ${time}\n`;
                if(loc) text += `ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${loc}\n`;
            }
            text += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n`;
            const items = this.getVisibleItems();
            const groups = {};
            items.forEach(item => { if(!groups[item.cat]) groups[item.cat]=[]; groups[item.cat].push(item); });
            const order = ['coffee', 'cooking', 'grill', 'sleep', 'hygiene', 'car', 'winter', 'custom'];
            let hasItems = false;
            order.forEach(cat => {
                if(groups[cat]) {
                    hasItems = true;
                    text += `*${this.categories[cat]}:*\n`;
                    groups[cat].forEach(i => {
                        const isChecked = this.state.checked.includes(String(i.id));
                        text += isChecked ? `âœ… ~${i.name}~\n` : `â¬œ ${i.name}\n`;
                    });
                    text += `\n`;
                }
            });
            if(!hasItems) text += "Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø£ØºØ±Ø§Ø¶.\n";
            text += `â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø±Ù…ÙˆØ²:\nâœ… Ø²Ù‡Ø§Ø¨Ù†Ø§ (Ø¬Ø§Ù‡Ø²)\nâ¬œ Ù…Ø·Ù„ÙˆØ¨ (Ù†Ø§Ù‚Øµ)\n\nØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø¨Ø± ØªØ·Ø¨ÙŠÙ‚: Ø²Ù‡Ø§Ø¨`;
            return text;
        },

        copyList: function() {
            const text = this.generateText();
            navigator.clipboard.writeText(text).then(() => {
                const toast = document.getElementById('toast');
                toast.textContent = "ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­! âœ…";
                toast.style.display = 'block';
                setTimeout(() => toast.style.display = 'none', 3000);
            });
        },

        shareWhatsApp: function() {
            const text = this.generateText();
            window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
        }
    };

    window.onload = () => app.init();
</script>

</body>
</html>